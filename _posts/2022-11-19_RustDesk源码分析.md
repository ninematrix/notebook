# RustDesk æºç åˆ†æ

## æºç åœ°å€

## ã€€æºç ç»“æ„

- **[libs/hbb_common](https://github.com/rustdesk/rustdesk/tree/master/libs/hbb_common)**: è§†é¢‘ç¼–è§£ç , é…ç½®, tcp/udp å°è£…, protobuf, æ–‡ä»¶ä¼ è¾“ç›¸å…³æ–‡ä»¶ç³»ç»Ÿæ“ä½œå‡½æ•°, ä»¥åŠä¸€äº›å…¶ä»–å®ç”¨å‡½æ•°
- **[libs/scrap](https://github.com/rustdesk/rustdesk/tree/master/libs/scrap)**: å±å¹•æˆªå–
- **[libs/enigo](https://github.com/rustdesk/rustdesk/tree/master/libs/enigo)**: å¹³å°ç›¸å…³çš„é¼ æ ‡é”®ç›˜è¾“å…¥
- **[src/ui](https://github.com/rustdesk/rustdesk/tree/master/src/ui)**: GUI
- **[src/server](https://github.com/rustdesk/rustdesk/tree/master/src/server)**: è¢«æ§ç«¯æœåŠ¡éŸ³é¢‘ã€å‰ªåˆ‡æ¿ã€è¾“å…¥ã€è§†é¢‘æœåŠ¡ã€ç½‘ç»œè¿æ¥çš„å®ç°
- **[src/client.rs](https://github.com/rustdesk/rustdesk/tree/master/src/client.rs)**: æ§åˆ¶ç«¯
- **[src/rendezvous_mediator.rs](https://github.com/rustdesk/rustdesk/tree/master/src/rendezvous_mediator.rs)**: ä¸[rustdesk-server](https://github.com/rustdesk/rustdesk-server)ä¿æŒUDPé€šè®¯, ç­‰å¾…è¿œç¨‹è¿æ¥ï¼ˆé€šè¿‡æ‰“æ´ç›´è¿æˆ–è€…ä¸­ç»§ï¼‰
- **[src/platform](https://github.com/rustdesk/rustdesk/tree/master/src/platform)**: å¹³å°æœåŠ¡ç›¸å…³ä»£ç 
- **[flutter](https://github.com/rustdesk/rustdesk/tree/master/flutter)**: ç§»åŠ¨ç‰ˆæœ¬çš„Flutterä»£ç 
- **[flutter/web/js](https://github.com/rustdesk/rustdesk/tree/master/flutter/web/js)**: Flutter Webç‰ˆæœ¬ä¸­çš„Javascriptä»£ç 

### .cargo

Rust é…ç½®æ–‡ä»¶config.toml.
é…ç½®äº†Windows ä¸‹å’ŒMacOSä¸‹çš„rustflag

### .github

é…ç½®githubä¸­çš„å†…å®¹.
workflow/ci.yml,github ciè„šæœ¬.

- jobs:
  - (å·²æ³¨é”€)ensure_cargo_fmt:ä¿è¯cargo fmt å·²è¿è¡Œ
  - (å·²æ³¨é”€)min_version:æ”¯æŒçš„æœ€ä½Rustç‰ˆæœ¬
  - build:æ„å»º
    - Checkout source code :ç”¨actions/checkout@v3æ£€å‡ºæºä»£ç 
    - Install prerequisites:å®‰è£…å‰ç½®è½¯ä»¶(åªçœ‹åˆ°æœ‰x86_64-unknown-linux-gnuä¸‹çš„å®‰è£…è„šæœ¬)
    - Restore from cache and install vcpkg:ç”¨lukka/run-vcpkg@v7å®‰è£…vcpkg
    - Install vcpkg dependencies:å®‰è£…vcpkgä¾èµ–libvpx libyuv opus,å…¶ä¸­(i686_winæ—¶,æŠ¥é”™ <https://mirrors.sjtug.sjtu.edu.cn/msys2/mingw/i686/mingw-w64-i686-pkg-config-0.29.2-2-any.pkg.tar.zstæœªèƒ½æ‰¾åˆ°),(x86_64-winæ—¶,nasm>æœªèƒ½æ‰¾åˆ°)
    - Install Rust toolchain:å®‰è£…Rust å·¥å…·é“¾
    - Show version information (Rust,cargo,GCC)
    - Swatinem/rust-cache@v1
    - Build:ç”¨actions-rs/cargo@v1,è¿›è¡Œæ„å»º
    - (å·²æ³¨é”€)Strip debug information from executable:
    - Set testing options:è®¾ç½®æµ‹è¯•é€‰é¡¹
    - Build tests:æ„å»ºæµ‹è¯•
    -

### docs

æ–‡æ¡£ç›®å½•.

- Contributing.md:å¦‚ä½•ä¸ºé¡¹ç›®åšè´¡çŒ®.PULL REQUESTæµç¨‹
- README-xx.md:è¯´æ˜æ–‡ä»¶

### flatpak(TODO)

è¿™é‡Œå­˜æ”¾`flatpak`çš„é…ç½®æ–‡ä»¶,rustdesk.jsonæ˜¯æ¸…å•æ–‡ä»¶,

> `flatpak`æ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å®ç”¨ç¨‹åºï¼Œå¯è®©æ‚¨åˆ†å‘ã€å®‰è£…å’Œç®¡ç†è½¯ä»¶ï¼Œè€Œæ— éœ€æ‹…å¿ƒä¾èµ–é¡¹ã€è¿è¡Œæ—¶æˆ– Linux åˆ†å‘ã€‚ç”±äºæ— è®ºåœ¨ Linux å‘è¡Œç‰ˆï¼ˆæ— è®ºæ˜¯åŸºäº Debian çš„å‘è¡Œç‰ˆè¿˜æ˜¯åŸºäº Arch çš„å‘è¡Œç‰ˆï¼‰ä¸Šï¼Œæ‚¨éƒ½å¯ä»¥æ¯«æ— é—®é¢˜åœ°å®‰è£…è½¯ä»¶ï¼Œå› æ­¤ Flatpak è¢«ç§°ä¸ºé€šç”¨è½¯ä»¶åŒ…ã€‚

### flutter

ç§»åŠ¨ç‰ˆæœ¬çš„ä»£ç 

- build_android_deps.sh:ç¼–è¯‘libyuv opus libvpx oboe for Android
- build_android.sh:ç¼–è¯‘apk
- build_ios.sh:ç¼–è¯‘iosåº”ç”¨
- ....
- pubspec.yaml:flutterçš„pub è¯´æ˜,ä¾èµ–çš„ç»„ä»¶ç­‰.

#### android

Android ä»£ç 

#### assets

ä¸€äº›SVGèµ„æºæ–‡ä»¶åŠå­—ä½“æ–‡ä»¶

#### ios

ios æºæ–‡ä»¶,åŒ…æ‹¬Podfile,Runneré¡¹ç›®æ–‡ä»¶,

#### lib

#### linux

#### macos

#### test

#### web

#### windows

### libs

**1. clipboard**
é€šè¿‡ç½‘ç»œè¿›è¡Œ**æ‹·è´**,**ç²˜è´´**,å‚è€ƒFreeRDPé¡¹ç›®çš„å®ç°(Windows Clipboard Redirection)

- wf_cliprdr.c,cè¯­è¨€å®ç°windowsä¸‹çš„ç²˜è´´æ¿æ“ä½œ;xf_cliprdr.c,cè¯­è¨€å®ç°X11ä¸‹ç²˜è´´æ¿çš„æ“ä½œ(åªéœ€å®ç°ä¸¤ä¸ªå‡½æ•°?);Clipboard.m,OSXä¸‹çš„ç²˜è´´æ¿æ“ä½œ(åŒX11)
- context_send.rs:contextå‘é€,å®ç°is_enabled(),enable(),proc,
-

**2. enigo**
enigo,ä¸€ä¸ªè·¨å¹³å°çš„è¾“å…¥æ¨¡æ‹Ÿå™¨(Rust),æ”¯æŒX11,MacOS,Winä¸‹çš„é¼ æ ‡å’Œæ–‡æœ¬è¾“å…¥.ä¾èµ–`libxdo-dev`.

**3. hbb_common**
hbbçš„ä¸€äº›å…¬å…±æ–‡ä»¶.
*protos*
è¯¥ç›®å½•ä¸‹åŒ…æ‹¬ä¸¤ä¸ªprotoæ–‡ä»¶,åˆ†åˆ«æ˜¯message.proto,rendezvois.proto;
> `proto3`æ˜¯protocal buffer(æ˜¯Googleå‡ºå“çš„åºåˆ—åŒ–æ¡†æ¶ï¼Œä¸å¼€å‘è¯­è¨€æ— å…³ï¼Œå’Œå¹³å°æ— å…³ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ã€‚Protobufå’Œæ‰€æœ‰çš„åºåˆ—åŒ–æ¡†æ¶ä¸€æ ·ï¼Œéƒ½å¯ä»¥ç”¨äºæ•°æ®å­˜å‚¨ã€é€šè®¯åè®®) V3
> æ˜¯ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå¯ä»¥ç”¨äºç»“æ„åŒ–æ•°æ®ä¸²è¡ŒåŒ–ï¼Œæˆ–è€…è¯´åºåˆ—åŒ–ã€‚å®ƒå¾ˆé€‚åˆåšæ•°æ®å­˜å‚¨æˆ–RPCæ•°æ®äº¤æ¢æ ¼å¼ã€‚å¯ç”¨äºé€šè®¯åè®®ã€æ•°æ®å­˜å‚¨ç­‰é¢†åŸŸçš„è¯­è¨€æ— å…³ã€å¹³å°æ— å…³ã€å¯æ‰©å±•çš„åºåˆ—åŒ–ç»“æ„æ•°æ®æ ¼å¼ã€‚

- [proto3è¯­æ³•æŒ‡å—](https://colobu.com/2017/03/16/Protobuf3-language-guide/)

*src*
platformæ–‡ä»¶å¤¹ä¸­åŒ…å«linux.rsä¸mod.rs,protosæ–‡ä»¶å¤¹ä¸­åŒ…æ‹¬ç”±å‰è¿°ä¸¤ä¸ªprotoæ–‡ä»¶ç»`rust-protobuf 3.1.0`è‡ªåŠ¨ç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶.
byes_codec.rs:ç¼–è§£ç æ¨¡å—
compress.rs:å‹ç¼©ä¸è§£å‹æ¨¡å—
config.rs:é…ç½®æ–‡ä»¶åŠå†…å®¹ç®¡ç†
fs.rs:File Send,æ–‡ä»¶è¯»å–\ä¼ è¾“\å†™å…¥æ¨¡å—
lib.rs:å…¶ä¸­AddrMangleç”¨æ¥å¯¹IPåœ°å€è¿›è¡ŒMangle,é˜²æ­¢æŸäº›è·¯ç”±å™¨ä¸é˜²ç«å¢™ä»æ•°æ®åŒ…åˆ†æå‡ºIPåœ°å€è¿›è€Œå¯¹å…¶è¿›è¡ŒNAT Mapping/Translation.
password_security.rs:å¯†ç å®‰å…¨æ¨¡å—.å¯†ç åŠ å¯†\è§„åˆ™
quic.rs:ä¸ä¸­ç»§æœåŠ¡å™¨é€šè®¯æ¨¡å—QUICåè®®
socket_client.rs:socks5ä»£ç†æœåŠ¡å™¨å®¢æˆ·ç«¯
tcp.rs:tcpé€šè®¯æ¨¡å—
udp.rs:udpé€šè®¯æ¨¡å—

**4. portable**
Portable ç‰ˆæœ¬

**5. scrap**
è·¨å¹³å°çš„å±å¹•å½•åˆ¶æ¨¡å—.

**6. simple_rc**

**7. virtual_display**
windows è™šæ‹Ÿæ˜¾ç¤ºæ”¯æŒ(æ²¡æœ‰æ˜¾ç¤ºå™¨ç›´è¿æ˜¾å¡)

### res

èµ„æºæ–‡ä»¶

### src

å®¢æˆ·ç«¯æºä»£ç 

#### client

å®¢æˆ·ç«¯å®ç°é€»è¾‘.
cli.rs:client ä¼šè¯ç®¡ç†
**client.rs**:clientçš„start,connect,secure_connect,request_relay,create_relay
clipboard_file.rs:ç²˜è´´æ¿ç®¡ç†,clip_2_msg,msg_2_clip
core_main.rs:æ ¸å¿ƒmain,flutterå’Œsciterå…±äº«,core_main,import_config,core_main_invoke_new_connection
flutter_ffi.rs:flutterçš„Foreign Function Interface,Flutter ä¸ Rustçš„äº¤äº’æ¥å£
flutter.rs:FFI for rustdesk core's main entry
**ipc.rs**:è´Ÿè´£UIä¸src/serveräº¤äº’
lan.rs:
lang.rs:å¤šè¯­è¨€æ”¯æŒ
lib.rs:rust lib
license.rs:æˆæƒæ–‡ä»¶ç®¡ç†
main.rs:ç¨‹åºä¸»å…¥å£global_initåui start
naming.rs:
oboe.cc:oboe å£°éŸ³æ’­æ”¾å™¨
port_forward.rs:ç«¯å£è½¬å‘å™¨
rc.rs:
**rendezvois_mediator.rs**:è´Ÿè´£ä¸serveræ³¨å†Œ/è·å–peer
server.rs:
tray.rs:ç³»ç»Ÿæ‰˜ç›˜
ui_cm_interface.rs:
ui_interface.rs:
ui_session_interface.rs
ui.rs:

#### hbbs_http

#### lang

#### platform

#### server

#### ui

### target

## Rust å¼€å‘

### Rustä¸‹çš„äº¤å‰ç¼–è¯‘

1. rustup toolchain install stable-x86_64-pc-windows-gnu
   **å¤‡æ³¨**: æç¤º- DEPRECATED
2. rustup target add x86_64-pc-windows-gnu --toolchain=stable
3. å®‰è£…linkerï¼šsudo apt install mingw-w64

- [Rust è¯­è¨€åœ£ç»](https://course.rs/about-book.html)

### rust-analyzer

[User Manual](https://rust-analyzer.github.io/manual.html)

## Flutter å¼€å‘

- [Flutter Doc](https://flutter.cn/docs)

## Sciter

> Sciter æ˜¯ä¸€ä¸ªç”¨ HTML/CSS æ¥æ¸²æŸ“ç°ä»£åº”ç”¨ç¨‹åº UI çš„è„šæœ¬å¼•æ“ã€‚ å®ƒéå¸¸ç´§å‡‘ï¼Œç®€å•ï¼ˆåªæœ‰ä¸€ä¸ª 4~8M çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ dll/dylib/soï¼‰ï¼Œæ²¡æœ‰å…¶ä»–ä¾èµ–ã€‚å®ƒå¯ä»¥å·¥ä½œåœ¨ Microsoft Windowsï¼ˆXP åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰, Apple OS X ï¼ˆ10.7 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰å’Œ Linux/GTK ï¼ˆGTK 3.0 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ã€‚ Sciter åœ¨è¾ƒæ–°çš„ Windows ç‰ˆæœ¬ä¸Šä½¿ç”¨ Direct2D GPU å›¾å½¢åŠ é€ŸæŠ€æœ¯ï¼Œåœ¨ Windows XP ä¸Šåˆ™ä½¿ç”¨ GDI+ æŠ€æœ¯ã€‚ åœ¨ OS X ä¸Šï¼Œå®ƒä½¿ç”¨æ ‡å‡†çš„ CoreGraphics æŠ€æœ¯, è€Œåœ¨ Linux ä¸Šä½¿ç”¨æ˜¯ Cairo åº“ã€‚

- [Sciter Rust](https://docs.rs/sciter-rs/latest/sciter/)
- [Sciter SDK for Rust](https://github.com/sciter-sdk/rust-sciter)
- [Sciter Rust Examples](https://github.com/sciter-sdk/rust-sciter/tree/master/examples)
- [Sciter SDK](https://sciter.com/download/)

## fastlane

> *fastlane* is the easiest way to automate beta deployments and releases for your iOS and Android apps. ğŸš€ It handles all tedious tasks, like generating screenshots, dealing with code signing, and releasing your application.

- [FastLane Doc](https://docs.fastlane.tools/)

## cario

`cario`æ˜¯ä¸€ä¸ªå›¾å½¢åº“,GTK+ 3.0åŸºäºè¯¥å›¾å½¢åº“å®ç°,firefoxä¹Ÿæ˜¯åŸºäºè¯¥å›¾å½¢åº“.

## QUICåè®®

> QUICï¼ˆQuick UDP Internet Connectionï¼‰ï¼Œåˆç§°ä¸ºå¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥ï¼Œæ˜¯ç”± Google æå‡ºçš„ä½¿ç”¨ UDP è¿›è¡Œå¤šè·¯å¹¶å‘ä¼ è¾“çš„åè®®ï¼ŒQUIC ç›¸æ¯”ç°åœ¨å¹¿æ³›åº”ç”¨çš„ TCP+TLS+HTTP2 åè®®æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š

- å‡å°‘è¿æ¥å»ºç«‹æ—¶é—´ã€‚
- æ”¹å–„æ‹¥å¡æ§åˆ¶ã€‚
- é¿å…é˜Ÿå¤´é˜»å¡çš„å¤šè·¯å¤ç”¨ã€‚
- è¿æ¥è¿ç§»ã€‚
[QUICåè®®åŸç†åˆ†æ](https://zhuanlan.zhihu.com/p/32553477)

## é—®é¢˜

- [x] æ˜¯å¦å¯ä»¥äº¤å‰ç¼–è¯‘?(Win\Linux\MacOS)
- [x] [RustDeskæºç åˆ†æ](https://cloud.tencent.com/developer/article/1897847)

## å‚è€ƒ

> ä» 2021 å¹´ 10 æœˆï¼Œåœ¨å°è¯• Flutter è·¨å¹³å°å¼€å‘æ•ˆæœä¸ä½³åï¼Œå¼€å§‹ä»¿ç…§ 1Password çš„æˆåŠŸç»éªŒï¼Œè¯•æ°´ rust åšåº”ç”¨æ ¸å¿ƒæ¨¡å—å¼€å‘ã€‚ç›®å‰ï¼ŒåŸºæœ¬èµ°é€šæ¨¡å¼ã€‚
> åŠå¹´å¤šçš„æ—¶é—´ï¼Œä» 0 åˆ° 3 ä¸ªå…¨èŒ rust å¼€å‘å·¥ç¨‹å¸ˆï¼Œæ ¸å¿ƒæ¨¡å—ä¸¤ä¸‡è¡Œä»£ç ï¼Œå¤–åŠ å„ç§ Bindings æ¶µç›– electron(based on neon), browser(based on wasm-bindgen), android/ios(based on mozilla/uniffi)ï¼Œterminal(based on tui)ï¼Œå’Œä¸¤ä¸ª SDK (py/cxx)ï¼Œæä¾›ä» Low Level çš„ HTTP/WS Clients åˆ° High Level çš„ ViewModelï¼Œå†åˆ°å„ä¸ªå¹³å°çš„ä»£ç é›†æˆã€‚
> è¦æ±‚
> æœ‰ Common Senseï¼Œå­¦ä¹ èƒ½åŠ›å¼ºï¼Œæœ‰è‡ªé©±åŠ›ã€‚
> ç†Ÿç»ƒæŒæ¡ä¸¤ç§ä»¥ä¸Šçš„ç¼–ç¨‹è¯­è¨€ï¼Œå¯¹ Rust åŠç”Ÿæ€æœ‰ä¸€å®šäº†è§£ã€‚
> ä¸é™æœåŠ¡ç«¯/å®¢æˆ·ç«¯èƒŒæ™¯ï¼Œä½†éœ€è¦ç†Ÿæ‚‰ä¸€äº›ç¼–ç¨‹èŒƒå¼ã€‚
> ç†Ÿç»ƒæŒæ¡ shell/git/vim(emacs)/github(gitlab)/docker ç­‰å¼€å‘å·¥å…·ã€‚
